---
stages:
  - rubocop
  - syntax
  - metadata
  - rspec

cache:
  paths:
    - vendor/bundle

before_script:
  - bundle -v
  - rm Gemfile.lock || true
  - gem update --system
  - gem --version
  - bundle -v
  - bundle install --without system_tests --path vendor/bundle --jobs $(nproc)

rubocop 2.4.4-Puppet ~> 5.5:
  stage: rubocop
  image: ruby:2.4.4
  script:
    - bundle exec rake rubocop
  variables:
    PUPPET_GEM_VERSION: '~> 5.5'

syntax 2.4.4-Puppet ~> 5.5:
  stage: syntax
  image: ruby:2.4.4
  script:
    - bundle exec rake syntax lint
  variables:
    PUPPET_GEM_VERSION: '~> 5.5'

metadata 2.4.4-Puppet ~> 5.5:
  stage: metadata
  image: ruby:2.4.4
  script:
    - bundle exec rake metadata_lint
  variables:
    PUPPET_GEM_VERSION: '~> 5.5'

rspec 2.4.4-Puppet ~> 5.5:
  stage: rspec
  image: ruby:2.4.4
  script:
    - bundle update
    - bundle exec rake $CHECK
  variables:
    PUPPET_GEM_VERSION: '~> 5.5'
    CHECK: spec